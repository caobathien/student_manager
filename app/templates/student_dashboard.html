{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/student_list.css') }}">

<div class="container mt-4">
    <h1 class="mb-4">Thông tin Sinh viên</h1>

    <div class="row">
        <!-- Thông tin cá nhân -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-user mr-2"></i>Thông tin cá nhân</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-4"><strong>Mã SV:</strong></div>
                        <div class="col-sm-8">{{ student.student_code }}</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4"><strong>Họ và tên:</strong></div>
                        <div class="col-sm-8">{{ student.full_name }}</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4"><strong>Ngày sinh:</strong></div>
                        <div class="col-sm-8">{{ student.date_of_birth.strftime('%d-%m-%Y') if student.date_of_birth else '' }}</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4"><strong>Giới tính:</strong></div>
                        <div class="col-sm-8">{{ student.gender }}</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4"><strong>Lớp:</strong></div>
                        <div class="col-sm-8">{{ student.class_rel.name if student.class_rel else 'N/A' }}</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4"><strong>GPA:</strong></div>
                        <div class="col-sm-8">{{ student.gpa }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Điểm số -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-line mr-2"></i>Điểm số</h5>
                </div>
                <div class="card-body">
                    {% if student.registered_subjects %}
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Môn học</th>
                                    <th>Giữa kì</th>
                                    <th>Cuối kì</th>
                                    <th>Trung bình</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for reg in student.registered_subjects %}
                                {% set grade = grades | selectattr('subject_id', 'equalto', reg.subject_id) | list | first %}
                                <tr>
                                    <td>{{ reg.subject.name }}</td>
                                    <td>{{ grade.midterm_score if grade and grade.midterm_score is not none else 0 }}</td>
                                    <td>{{ grade.final_score if grade and grade.final_score is not none else 0 }}</td>
                                    <td>
                                        {% if grade and grade.midterm_score is not none and grade.final_score is not none %}
                                            {{ "%.2f"|format((grade.midterm_score + grade.final_score * 2) / 3) }}
                                        {% else %}
                                            0.00
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <div class="mt-3">
                            <strong>GPA tổng: {{ student.gpa }}</strong>
                        </div>
                    {% else %}
                        <p class="text-muted">Chưa đăng ký môn học nào.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Môn học đã đăng ký -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-book mr-2"></i>Môn học đã đăng ký</h5>
                </div>
                <div class="card-body">
                    {% if student.registered_subjects %}
                        <ul class="list-group">
                            {% for reg in student.registered_subjects %}
                            <li class="list-group-item">{{ reg.subject.code }} - {{ reg.subject.name }}</li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted">Chưa đăng ký môn học nào.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
